/* appgyver.js (full) version 0.9.1 */
((function(){var a,b,c=Array.prototype.slice;a=function(){function a(a){var b,d,e,f;return e="done fail isResolved isRejected promise then always pipe".split(" "),f={},f._Deferred=function(){var a,b,d,e,f,g,h,i;return i="pending",b=[],h=void 0,g=0,e=void 0,f=void 0,a=void 0,d={done:function(){var a,h,i,j,k;h=1<=arguments.length?c.call(arguments,0):[],g&&(g=0,i=1);for(j=0,k=h.length;j<k;j++)a=h[j],b.push(a);return i&&d.resolveWith.apply(d,[f].concat(c.call(e))),this},resolve:function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],d.resolveWith.apply(d,[d].concat(c.call(a)))},resolveWith:function(){var d,j,k;j=arguments[0],d=2<=arguments.length?c.call(arguments,1):[];if(!a&&!g&&!h){h=1;try{while(b[0])(k=b.shift()).call.apply(k,[j].concat(c.call(d)))}finally{h=0,g=1,f=j,e=d,i="resolved"}}return this},cancel:function(){return a=1,b=[],this},isResolved:function(){return!!h||!!g},state:function(){return i}},d},b=new f._Deferred,d=new f._Deferred,b.always=function(){var a,d;return a=1<=arguments.length?c.call(arguments,0):[],(d=b.done.apply(b,a)).fail.apply(d,a)},b.fail=d.done,b.reject=d.resolve,b.rejectWith=d.resolveWith,b.isRejected=d.isResolved,b.pipe=function(a,b){},b.then=function(a,c){return b.done(a).fail(c),b},b.promise=function(a){var b,c,d;a==null&&(a={});for(c=0,d=e.length;c<d;c++)b=e[c],a[b]=this[b];return a},b.done(d.cancel).fail(b.cancel),delete b.cancel,typeof a=="function"&&a.call(b,b),b}return a}(),b=function(){function b(){return a}return b}(),window.DeferredEngine=b})).call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=function(a,b){return function(){return a.apply(b,arguments)}},y=Object.prototype.hasOwnProperty,z=function(a,b){function d(){this.constructor=a}for(var c in b)y.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},A=Array.prototype.slice;g=function(){function a(){}return a.prototype.send=function(a,b){},a}(),window.AndroidCommunication=function(){function a(){return this.message_handler=x(this.message_handler,this),AndroidAPIBridge.registerHandler("AG.API.ws.message_handler"),window.AG_SCREEN_ID=AndroidAPIBridge.getAGScreenId(),window.AG_LAYER_ID=AndroidAPIBridge.getAGLayerId(),window.AG_VIEW_ID=AndroidAPIBridge.getAGViewId(),!0}return a.prototype.uid=0,a.prototype.callbacks={},a.prototype.message_handler=function(a){var b;b=JSON.parse(a);if((b!=null?b.callback:void 0)!=null&&this.callbacks[b.callback]!=null)return this.callbacks[b.callback].call(b.parameters,b.parameters)},a.prototype.send=function(a,b){var c,d,e,f=this;return(b!=null?b.callbacks:void 0)!=null?(c=""+a+"_"+this.uid++,d={},b.callbacks.recurring!=null&&(d.recurring=""+c+"_recurring",this.callbacks[d.recurring]=function(a){return b.callbacks.recurring.call(a,a)}),b.callbacks.success!=null&&(d.success=""+c+"_success",this.callbacks[d.success]=function(a){return delete f.callbacks[d.success],delete f.callbacks[d.failure],b.callbacks.success.call(a,a)}),b.callbacks.failure!=null&&(d.failure=""+c+"_fail",this.callbacks[d.failure]=function(a){return delete f.callbacks[d.success],delete f.callbacks[d.failure],b.callbacks.failure.call(a,a)})):d={},e=JSON.stringify({method:a,parameters:(b!=null?b.parameters:void 0)!=null?b.parameters:{},callbacks:d}),AndroidAPIBridge.send(e)},a}(),window.WebSocketCommunication=function(){function a(){this.send=x(this.send,this),this.message_handler=x(this.message_handler,this),this.map_context=x(this.map_context,this),this.reopen=x(this.reopen,this),this.websocket=new WebSocket("ws://localhost:31337"),this.websocket.onmessage=this.message_handler,this.websocket.onclose=this.reopen,this.websocket.addEventListener("open",this.map_context)}return a.prototype.uid=0,a.prototype.callbacks={},a.prototype.reopen=function(){return this.websocket=new WebSocket("ws://localhost:31337"),this.websocket.onmessage=this.message_handler,this.websocket.onclose=this.reopen,this.websocket.addEventListener("open",this.map_context),!1},a.prototype.map_context=function(){if(typeof AG_SCREEN_ID!="undefined"&&AG_SCREEN_ID!==null&&typeof AG_LAYER_ID!="undefined"&&AG_LAYER_ID!==null&&typeof AG_VIEW_ID!="undefined"&&AG_VIEW_ID!==null)return this.send("mapWebSocketConnectionToContext",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID}})},a.prototype.message_handler=function(a){var b;b=JSON.parse(a.data),console.log(b);if((b!=null?b.callback:void 0)!=null&&this.callbacks[b.callback]!=null)return this.callbacks[b.callback].call(b.parameters,b.parameters)},a.prototype.send=function(a,b){var c,d,e,f=this;return(b!=null?b.callbacks:void 0)!=null?(c=""+a+"_"+this.uid++,d={},b.callbacks.recurring!=null&&(d.recurring=""+c+"_recurring",this.callbacks[d.recurring]=function(a){return b.callbacks.recurring.call(a,a)}),b.callbacks.success!=null&&(d.success=""+c+"_success",this.callbacks[d.success]=function(a){return delete f.callbacks[d.success],delete f.callbacks[d.failure],b.callbacks.success.call(a,a)}),b.callbacks.failure!=null&&(d.failure=""+c+"_fail",this.callbacks[d.failure]=function(a){return delete f.callbacks[d.success],delete f.callbacks[d.failure],b.callbacks.failure.call(a,a)})):d={},e=JSON.stringify({method:a,parameters:(b!=null?b.parameters:void 0)!=null?b.parameters:{},callbacks:d}),this.websocket.readyState===0?this.websocket.addEventListener("open",function(){return f.websocket.send(e)}):this.websocket.send(e)},a}(),p=function(a){function b(){this.url_for=x(this.url_for,this),this.send=x(this.send,this),this.send_wrapper=x(this.send_wrapper,this),this.find_delete_and_return_callback=x(this.find_delete_and_return_callback,this),this.remove_callback=x(this.remove_callback,this),this.create_callback=x(this.create_callback,this)}return z(b,a),b.prototype.html_channels_inserted=!1,b.prototype.private_callback_pool={},b.prototype.uid=0,b.prototype.create_callback=function(a,b,c,d){},b.prototype.remove_callback=function(a){},b.prototype.find_delete_and_return_callback=function(a){},b.prototype.send_wrapper=function(a,b,c,d,e){},b.prototype.send=function(a,b){},b.prototype.uri="http://client.appgyver/",b.prototype.current_channel=0,b.prototype.insert_html_channels=function(){},b.prototype.url_for=function(a,b){},b}(g),a=function(){function a(a,b){this.cancelAllDownloads=x(this.cancelAllDownloads,this),this.recordEvent=x(this.recordEvent,this),this.popLayer=x(this.popLayer,this),this.reloadStartURL=x(this.reloadStartURL,this),this.cameraFlashToggle=x(this.cameraFlashToggle,this),this.cameraFlashOff=x(this.cameraFlashOff,this),this.cameraFlashOn=x(this.cameraFlashOn,this),this.getUserLocale=x(this.getUserLocale,this),this.removeAllWSEventListeners=x(this.removeAllWSEventListeners,this),this.addWSEventListener=x(this.addWSEventListener,this),this.previewFile=x(this.previewFile,this),this.choosePicture=x(this.choosePicture,this),this.hideNavigationBarRightButton=x(this.hideNavigationBarRightButton,this),this.showNavigationBarRightButton=x(this.showNavigationBarRightButton,this),this.openLayer=x(this.openLayer,this),this.hideNavigationBar=x(this.hideNavigationBar,this),this.showNavigationBar=x(this.showNavigationBar,this),this.ping=x(this.ping,this),this.takeVideo=x(this.takeVideo,this),this.unzip=x(this.unzip,this),this.writeFile=x(this.writeFile,this),this.downloadFile=x(this.downloadFile,this),this.game=x(this.game,this),this.removeFileOrFolder=x(this.removeFileOrFolder,this),this.takePicture=x(this.takePicture,this),this.getIPAddress=x(this.getIPAddress,this),this.takeScreenshot=x(this.takeScreenshot,this),this.play=x(this.play,this),this.stopRecordingAudio=x(this.stopRecordingAudio,this),this.startRecordingAudio=x(this.startRecordingAudio,this),this.say=x(this.say,this),this.alert=x(this.alert,this),this.removeSplashScreen=x(this.removeSplashScreen,this),this.resolveUserDetails=x(this.resolveUserDetails,this),this.resolveUserLocation=x(this.resolveUserLocation,this),this.setTopBarImagePath=x(this.setTopBarImagePath,this),this.setWebViewBackgroundColor=x(this.setWebViewBackgroundColor,this),this.resolveUDID=x(this.resolveUDID,this),this.getFeatureID=x(this.getFeatureID,this),this.log=x(this.log,this),this.removeAllEventListeners=x(this.removeAllEventListeners,this),this.removeEventListener=x(this.removeEventListener,this),this.addEventListener=x(this.addEventListener,this),this.saveDocument=x(this.saveDocument,this),this.loadDocument=x(this.loadDocument,this),this.removeBackButton=x(this.removeBackButton,this),this.backButton=x(this.backButton,this),this.removeRightButton=x(this.removeRightButton,this),this.rightButton=x(this.rightButton,this),this.unfreeze=x(this.unfreeze,this),this.freeze=x(this.freeze,this),this._send=a.send,this.send=a.send_wrapper,this.ws=b,this.callbacks={remove:a.remove_callback,find:a.find_delete_and_return_callback}}return a.prototype.send=function(){throw"AG.API communication module not loaded."},a.prototype.freeze=function(a,b,c,d,e){return typeof e=="undefined"&&(e=null),typeof d=="undefined"&&(d=!1),this.send("freeze",{spinnerAfterTransition:d,color:e,effect:a,duration:b,delay:c},null,null,!0)},a.prototype.unfreeze=function(){return this.send("unfreeze",null,null,null,!0)},a.prototype.rightButton=function(a,b){return this.send("rightButton",{callback:"",title:a},!1,b)},a.prototype.removeRightButton=function(){return this.send("rightButton",null,null,null,!0)},a.prototype.backButton=function(a){return this.send("backButton",{callback:""},!1,a)},a.prototype.removeBackButton=function(){this.send("backButton",null,null,null,!0)},a.prototype.loadDocument=function(a){return this.send("loadDocument",{successCallback:"",failureCallback:"",key:a},!0)},a.prototype.saveDocument=function(a,b,c){return c==null&&(c=!1),this.send("saveDocument",{document:JSON.stringify(b),isTemporary:c,key:a,successCallback:"",failureCallback:""},!0)},a.prototype.addEventListener=function(a,b,c){return b!=null&&typeof b=="function"&&c?this.send("addEventListener",{event:a,callback:""},!0,b):b!=null&&typeof b=="function"?this.send("addEventListener",{event:a,callback:""},!1,b):this.send("addEventListener",{event:a,callback:""},!0)},a.prototype.removeEventListener=function(a){return this.send("removeEventListener",{event:a},null,null,!0)},a.prototype.removeAllEventListeners=function(){return this.send("removeAllEventListeners",null,null,null,!0)},a.prototype.log=function(a){return this.ws.send("log",{parameters:{text:a}})},a.prototype.getFeatureID=function(){return this.send("resolveFeatureID",{successCallback:""},!0)},a.prototype.resolveUDID=function(){return this.send("resolveUDID",{successCallback:""},!0)},a.prototype.setWebViewBackgroundColor=function(a){return this.send("setWebViewBackgroundColor",{color:a},null,null,!0)},a.prototype.setTopBarImagePath=function(a){return this.send("setTopBarImagePath",{path:a},null,null,!0)},a.prototype.resolveUserLocation=function(){return this.send("resolveUserLocation",null,null,null,!0)},a.prototype.resolveUserDetails=function(a,b,c){return this.send("resolveUserDetails",{linkType:a,title:b,message:c,successCallback:"",failureCallback:""},!0)},a.prototype.removeSplashScreen=function(a){return this.send("removeSplashScreen",{effect:a},null,null,!0)},a.prototype.alert=function(a,b){return this.ws.send("alert",{parameters:{title:a,message:b}})},a.prototype.say=function(a){return this.ws.send("say",{parameters:{text:a}})},a.prototype.startRecordingAudio=function(a){return this.ws.send("startRecordingAudio",{parameters:{filenameWithPath:""+a}})},a.prototype.stopRecordingAudio=function(){return this.ws.send("stopRecordingAudio")},a.prototype.play=function(a){return this.ws.send("play",{parameters:{filenameWithPath:a}})},a.prototype.takeScreenshot=function(a,b){return this.ws.send("takeScreenshot",{parameters:{},callbacks:{success:a,failure:b}})},a.prototype.getIPAddress=function(a,b){return this.ws.send("getIPAddress",{parameters:{},callbacks:{success:a,failure:b}})},a.prototype.takePicture=function(a,b,c){var d;return d=function(a){return a.imagePath="../../"+a.imagePath,b.call(a,a)},this.ws.send("takePicture",{parameters:{filenameWithPath:a},callbacks:{success:d,failure:c}})},a.prototype.removeFileOrFolder=function(a,b,c){return this.ws.send("removeFileOrDirectory",{parameters:{path:a},callbacks:{success:b,failure:c}})},a.prototype.game=function(){return this.ws.send("game")},a.prototype.downloadFile=function(a,b,c,d,e){return this.ws.send("downloadFile",{parameters:{filenameWithPath:a,url:b},callbacks:{success:c,failure:d,recurring:e}})},a.prototype.writeFile=function(a,b,c,d){return this.ws.send("writeFile",{parameters:{filenameWithPath:a,contents:b},callbacks:{success:c,failure:d}})},a.prototype.unzip=function(a,b,c,d){return this.ws.send("unzip",{parameters:{filenameWithPath:a,path:b},callbacks:{success:c,failure:d}})},a.prototype.takeVideo=function(a,b,c){return this.ws.send("takeVideo",{parameters:{filenameWithPath:a},callbacks:{success:b,failure:c}})},a.prototype.ping=function(a,b,c){return this.ws.send("ping",{parameters:{payload:a},callbacks:{success:b,failure:c}})},a.prototype.showNavigationBar=function(a,b){return this.ws.send("showNavigationBar",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID,title:a,titleImagePath:b}})},a.prototype.hideNavigationBar=function(){return this.ws.send("hideNavigationBar",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID}})},a.prototype.openLayer=function(a,b,c,d,e,f){var g;return g={screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID,url:a,hidesNavigationBar:b},c!=null&&(g.pushAnimation=c,g.pushAnimationDuration=1),g.pushAnimationDuration==null&&(g.pushAnimationDuration=d),e!=null&&(g.popAnimation=e,g.popAnimationDuration=1),g.popAnimationDuration==null&&(g.popAnimationDuration=f),this.ws.send("openLayer",{parameters:g})},a.prototype.showNavigationBarRightButton=function(a,b,c,d){return this.ws.send("showNavigationBarRightButton",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID,title:a},callbacks:{recurring:b,success:d,failure:c}})},a.prototype.hideNavigationBarRightButton=function(){return this.ws.send("hideNavigationBarRightButton",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID}})},a.prototype.choosePicture=function(a,b,c,d,e,f,g){var h;return h=function(a){return a.imagePath="../../"+a.imagePath,f.call(a,a)},this.ws.send("choosePicture",{parameters:{filenameWithPath:a,cameraButtonTitle:b,libraryButtonTitle:c,cancelButtonTitle:d,dialogTitle:e},callbacks:{success:h,failure:g}})},a.prototype.previewFile=function(a,b,c){return this.ws.send("previewFile",{parameters:{filenameWithPath:a},callbacks:{success:b,failure:c}})},a.prototype.addWSEventListener=function(a,b,c,d){return this.ws.send("addEventListener",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID,event:a},callbacks:{recurring:b,success:c,failure:d}})},a.prototype.removeAllWSEventListeners=function(a,b){return this.ws.send("removeAllEventListeners",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID},callbacks:{success:a,failure:b}})},a.prototype.getUserLocale=function(a,b){return this.ws.send("getUserLocale",{callbacks:{success:a,failure:b}})},a.prototype.cameraFlashOn=function(a,b){return this.ws.send("cameraFlashOn",{callbacks:{success:a,failure:b}})},a.prototype.cameraFlashOff=function(a,b){return this.ws.send("cameraFlashOff",{callbacks:{success:a,failure:b}})},a.prototype.cameraFlashToggle=function(a,b){return this.ws.send("cameraFlashToggle",{callbacks:{success:a,failure:b}})},a.prototype.reloadStartURL=function(a,b){return this.ws.send("reloadStartURL",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID},callbacks:{success:a,failure:b}})},a.prototype.popLayer=function(){return this.ws.send("popLayer",{parameters:{screen:AG_SCREEN_ID,layer:AG_LAYER_ID,view:AG_VIEW_ID}})},a.prototype.recordEvent=function(a,b,c){return this.ws.send("recordEvent",{parameters:{type:a,attributes:b},callbacks:{success:c}})},a.prototype.cancelAllDownloads=function(a,b){return this.ws.send("cancelAllDownloads",{success:a,failure:b})},a}(),t=function(){function a(){}return a.prototype.get=function(a,b,c){var d;return d=AG.API.loadDocument(a),b!=null&&d.done(b),c!=null&&d.fail(c),d},a.prototype.set=function(a,b,c,d){var e;return e=AG.API.saveDocument(a,b,!1),c!=null&&e.done(c),d!=null&&e.done(d),e},a.prototype.temporary={set:function(a,b,c,d){var e;return e=AG.API.saveDocument(a,b,!0),c!=null&&e.done(c),d!=null&&e.done(d),e}},a}(),n=function(){function a(){this.popLayer=x(this.popLayer,this),this.reloadStartURL=x(this.reloadStartURL,this),this.hideNavigationBarRightButton=x(this.hideNavigationBarRightButton,this),this.showNavigationBarRightButton=x(this.showNavigationBarRightButton,this),this.openLayer=x(this.openLayer,this),this.hideNavigationBar=x(this.hideNavigationBar,this),this.showNavigationBar=x(this.showNavigationBar,this),this.removeSplashScreen=x(this.removeSplashScreen,this),this.alert=x(this.alert,this),this.hideRightButton=x(this.hideRightButton,this),this.showRightButton=x(this.showRightButton,this),this.setTopBarImagePath=x(this.setTopBarImagePath,this),this.setWebViewBackgroundColor=x(this.setWebViewBackgroundColor,this)}return a.prototype.setWebViewBackgroundColor=function(a){return AG.API.setWebViewBackgroundColor(a)},a.prototype.setTopBarImagePath=function(a){return AG.API.setTopBarImagePath(a)},a.prototype.showRightButton=function(a,b){return AG.API.rightButton(a,b)},a.prototype.hideRightButton=function(){return AG.API.removeRightButton()},a.prototype.alert=function(a,b){return AG.API.alert(a,b)},a.prototype.removeSplashScreen=function(a){return AG.API.removeSplashScreen(a)},a.prototype.showNavigationBar=function(a){return a==null&&(a={}),Object.prototype.toString.call(a)==="[object String]"&&(a={title:a}),AG.API.showNavigationBar(a.title,a.titleImagePath)},a.prototype.hideNavigationBar=function(){return AG.API.hideNavigationBar()},a.prototype.openLayer=function(a,b){return AG.API.openLayer(a,(b!=null?b.hidesNavigationBar:void 0)||!1,b!=null?b.pushAnimation:void 0,b!=null?b.pushAnimationDuration:void 0,b!=null?b.popAnimation:void 0,b!=null?b.popAnimationDuration:void 0)},a.prototype.showNavigationBarRightButton=function(a,b,c,d){return AG.API.showNavigationBarRightButton(a,b,c,d)},a.prototype.hideNavigationBarRightButton=function(){return AG.API.hideNavigationBarRightButton()},a.prototype.reloadStartURL=function(){return AG.API.reloadStartURL()},a.prototype.popLayer=function(){return AG.API.popLayer()},a}(),c=function(){function a(){}return a.prototype.config={duration:.35,spinner:!0,color:"FFFFFFFF"},a.prototype.start=function(a,b){var c,d,e;return d=(b!=null?b.duration:void 0)!=null?b.duration:this.config.duration,e=(b!=null?b.spinner:void 0)!=null?b.spinner:this.config.spinner,c=(b!=null?b.color:void 0)!=null?b.color:this.config.color,AG.API.freeze(a,d,0,e,c)},a.prototype.stop=function(){return AG.API.unfreeze()},a}(),u=function(){function a(){}return a.prototype.getDetails=function(a,b,c,d,e){var f;f=AG.API.resolveUserDetails(a,b,c),d!=null&&f.done(d);if(e!=null)return f.fail(e)},a}(),q=function(){function a(){}return a.prototype.initialized=!1,a.prototype.success=function(a){var b,c;c=[];while(AG.geolocation.callbacks.length)b=AG.geolocation.callbacks.pop(),c.push(b.resolve(a));return c},a.prototype.failure=function(){var a,b;b=[];while(AG.geolocation.callbacks.length)a=AG.geolocation.callbacks.pop(),b.push(a.reject());return b},a.prototype.callbacks=[],a.prototype.getCurrentLocation=function(a,b){var c;return AG.geolocation.initialized||(AG.API.addEventListener("userLocationResolved",AG.geolocation.success,!0),AG.API.addEventListener("userLocationResolvingFailed",AG.geolocation.failure,!1),AG.geolocation.initialized=!0),c=new AG.Deferred,AG.geolocation.callbacks.push(c),a!=null&&c.done(a),b!=null&&c.fail(b),AG.API.resolveUserLocation(),c},a}(),b=function(){function a(){this.stopTracking=x(this.stopTracking,this),this.startTracking=x(this.startTracking,this),this.triggerCallbacks=x(this.triggerCallbacks,this),this.removeAllEventListeners=x(this.removeAllEventListeners,this),this.removeEventListener=x(this.removeEventListener,this),this.addEventListener=x(this.addEventListener,this)}return a.prototype.listener=null,a.prototype.callbacks={},a.prototype.addEventListener=function(a){var b;return b=(new Date).getTime(),AG.accelerometer.callbacks[b]=a,b},a.prototype.removeEventListener=function(a){return delete this.callbacks[a]},a.prototype.removeAllEventListeners=function(){return this.callbacks={}},a.prototype.triggerCallbacks=function(a,b,c,d){var e,f,g,h;g=this.callbacks,h=[];for(f in g)e=g[f],h.push(e.call(null,a,b,c,d));return h},a.prototype.startTracking=function(){return this.listener=function(a){return AG.accelerometer.triggerCallbacks(a.acceleration,a.accelerationIncludingGravity,a.rotationRate,a.interval)},window.addEventListener("devicemotion",this.listener,!0)},a.prototype.stopTracking=function(){return window.removeEventListener("devicemotion",this.listener,!0),this.listener=null},a}(),o=function(){function a(){this.stopTracking=x(this.stopTracking,this),this.startTracking=x(this.startTracking,this),this.triggerCallbacks=x(this.triggerCallbacks,this),this.removeAllEventListeners=x(this.removeAllEventListeners,this),this.removeEventListener=x(this.removeEventListener,this),this.addEventListener=x(this.addEventListener,this)}return a.prototype.listener=null,a.prototype.callbacks={},a.prototype.addEventListener=function(a){var b;return b=(new Date).getTime(),AG.gyroscope.callbacks[b]=a,b},a.prototype.removeEventListener=function(a){return delete this.callbacks[a]},a.prototype.removeAllEventListeners=function(){return this.callbacks={}},a.prototype.triggerCallbacks=function(a,b,c){var d,e,f,g;f=this.callbacks,g=[];for(e in f)d=f[e],g.push(d.call(null,a,b,c));return g},a.prototype.startTracking=function(){return this.listener=function(a){return AG.gyroscope.triggerCallbacks(a.alpha,a.beta,a.gamma)},window.addEventListener("deviceorientation",this.listener,!0)},a.prototype.stopTracking=function(){return window.removeEventListener("deviceorientation",this.listener,!0),this.listener=null},a}(),h=function(){function a(){this.stopTracking=x(this.stopTracking,this),this.startTracking=x(this.startTracking,this),this.triggerCallbacks=x(this.triggerCallbacks,this),this.removeAllEventListeners=x(this.removeAllEventListeners,this),this.removeEventListener=x(this.removeEventListener,this),this.addEventListener=x(this.addEventListener,this)}return a.prototype.listener=null,a.prototype.callbacks={},a.prototype.addEventListener=function(a){var b;return b=(new Date).getTime(),AG.compass.callbacks[b]=a,b},a.prototype.removeEventListener=function(a){return delete this.callbacks[a]},a.prototype.removeAllEventListeners=function(){return this.callbacks={}},a.prototype.triggerCallbacks=function(a,b){var c,d,e,f;e=this.callbacks,f=[];for(d in e)c=e[d],f.push(c.call(null,a,b));return f},a.prototype.startTracking=function(){return this.listener=function(a){return AG.compass.triggerCallbacks(a.webkitCompassHeading,a.webkitCompassAccuracy)},window.addEventListener("deviceorientation",this.listener,!0)},a.prototype.stopTracking=function(){return window.removeEventListener("deviceorientation",this.listener,!0),this.listener=null},a}(),l=function(){function a(){this.add=x(this.add,this)}return a.prototype.add=function(a){var b,c,d;if(AG[a.namespace]!=null)throw"Invalid extension namespace";AG[a.namespace]={},d=[];for(b in a)c=a[b],d.push(AG[a.namespace][b]=c);return d},a}(),i=function(){function a(){}return a.prototype.getUDID=function(a,b){var c;return c=AG.API.resolveUDID(),a!=null&&c.done(a),b!=null&&c.fail(b),c},a.prototype.getIPAddress=function(a,b){var c;return c=new AG.Deferred,AG.API.getIPAddress(c.resolve,c.reject),a!=null&&c.done(a),b!=null&&c.fail(b),c},a.prototype.getLocale=function(a,b){var c;return c=new AG.Deferred,AG.API.getUserLocale(c.resolve,c.reject),a!=null&&c.done(a),b!=null&&c.fail(b),c},a.prototype.takeScreenshot=function(a,b){var c;return c=new AG.Deferred,AG.API.takeScreenshot(c.resolve,c.reject),a!=null&&c.done(a),b!=null&&c.fail(b),c},a}(),f=function(){function a(){}return a.prototype.takePicture=function(a,b,c){var d;d=AG.Deferred(),AG.API.takePicture(a,d.resolve,d.reject),b!=null&&d.done(b);if(c!=null)return d.fail(c)},a.prototype.takeVideo=function(a,b,c){var d;d=AG.Deferred(),AG.API.takeVideo(a,d.resolve,d.reject),b!=null&&d.done(b);if(c!=null)return d.fail(c)},a.prototype.choosePicture=function(a,b,c){var d;d=AG.Deferred(),a.title==null&&(a.title="Select source"),a.cancel_button==null&&(a.cancel_button="Cancel"),a.camera_button==null&&(a.camera_button="Open Camera"),a.library_button==null&&(a.library_button="Choose From Library"),AG.API.choosePicture(a.filename,a.camera_button,a.library_button,a.cancel_button,a.title,d.resolve,d.reject),b!=null&&d.done(b);if(c!=null)return d.fail(c)},a.prototype.flashOn=function(a,b){var c;c=AG.Deferred(),AG.API.cameraFlashOn(c.resolve,c.reject),a!=null&&c.done(a);if(b!=null)return c.fail(b)},a.prototype.flashOff=function(a,b){var c;c=AG.Deferred(),AG.API.cameraFlashOff(c.resolve,c.reject),a!=null&&c.done(a);if(b!=null)return c.fail(b)},a.prototype.flashToggle=function(a,b){var c;c=AG.Deferred(),AG.API.cameraFlashToggle(c.resolve,c.reject),a!=null&&c.done(a);if(b!=null)return c.fail(b)},a}(),r=function(){function a(){}return a.prototype.startRecordingAudio=function(a){return AG.API.startRecordingAudio(""+a)},a.prototype.stopRecordingAudio=function(){return AG.API.stopRecordingAudio()},a.prototype.play=function(a){return AG.API.play(""+a)},a}(),j=function(){function a(a){this.event_name=a,this.triggerCallbacks=x(this.triggerCallbacks,this),this.removeAllEventListeners=x(this.removeAllEventListeners,this),this.removeEventListener=x(this.removeEventListener,this),this.addEventListener=x(this.addEventListener,this),this.callbacks={},this.listened=!1}return a.prototype.addEventListener=function(a,b,c){var d;return this.listened||(this.listened=!0,AG.API.addWSEventListener(this.event_name,AG.events[this.event_name].triggerCallbacks,b,c)),d=(new Date).getTime(),this.callbacks[d]=a,d},a.prototype.removeEventListener=function(a){return delete this.callbacks[a]},a.prototype.removeAllEventListeners=function(){return this.callbacks={},this.listened=!1},a.prototype.triggerCallbacks=function(){var a,b,c,d,e;a=1<=arguments.length?A.call(arguments,0):[],d=this.callbacks,e=[];for(c in d)b=d[c],e.push(b.call(a));return e},a}(),k=function(){function a(){this.recordEvent=x(this.recordEvent,this),this.removeAllEventListeners=x(this.removeAllEventListeners,this),this.addEventListener=x(this.addEventListener,this)}return a.prototype.focus=new j("focus"),a.prototype.lostFocus=new j("lostFocus"),a.prototype.addEventListener=function(a,b,c){if(typeof AG_SCREEN_ID!="undefined"&&AG_SCREEN_ID!==null||typeof AG_LAYER_ID!="undefined"&&AG_LAYER_ID!==null||typeof AG_VIEW_ID!="undefined"&&AG_VIEW_ID!==null){c==null&&(c={}),typeof b=="function"&&(c.recurring=b);switch(a){case"focus":return this.focus.addEventListener(c.recurring,c.success,c.failure);case"unfocus":case"lostFocus":return this.lostFocus.addEventListener(c.recurring,c.success,c.failure)}}else switch(a){case"focus":return AG.API.addEventListener("focus",b,!1);case"unfocus":case"lostFocus":return AG.API.addEventListener("lostFocus",b,!1);case"topDoubleTapped":return AG.API.addEventListener("topDoubleTapped",b,!1)}},a.prototype.removeAllEventListeners=function(){return typeof AG_SCREEN_ID!="undefined"&&AG_SCREEN_ID!==null||typeof AG_LAYER_ID!="undefined"&&AG_LAYER_ID!==null||typeof AG_VIEW_ID!="undefined"&&AG_VIEW_ID!==null?AG.API.removeAllWSEventListeners():AG.API.removeAllEventListeners()},a.prototype.recordEvent=function(a,b,c){return AG.API.recordEvent(a,b,c)},a}(),m=function(){function a(){this.cancelDownloads=x(this.cancelDownloads,this),this.remove=x(this.remove,this)}return a.prototype.preview=function(a,b,c){var d;return d=new AG.Deferred,AG.API.previewFile(""+a,d.resolve,d.reject),b!=null&&d.done(b),c!=null&&d.fail(c),d},a.prototype.download=function(a,b,c,d,e){var f;return f=new AG.Deferred,AG.API.downloadFile(""+a,b,f.resolve,f.reject,e),c!=null&&f.done(c),d!=null&&f.fail(d),f},a.prototype.unzip=function(a,b,c,d){var e;return e=new AG.Deferred,AG.API.unzip(""+a,""+b,e.resolve,e.reject),c!=null&&e.done(c),d!=null&&e.fail(d),e},a.prototype.write=function(a,b,c,d){var e;return e=new AG.Deferred,AG.API.writeFile(""+a,b,e.resolve,e.reject),c!=null&&e.done(c),d!=null&&e.fail(d),e},a.prototype.remove=function(a,b,c){var d;return d=new AG.Deferred,AG.API.removeFileOrFolder(""+a,d.resolve,d.reject),b!=null&&d.done(b),c!=null&&d.fail(c),d},a.prototype.cancelDownloads=function(a,b){var c;c=new AG.Deferred,AG.API.cancelAllDownloads(c.resolve,c.reject),a!=null&&c.done(a);if(b!=null)return c.fail(b)},a}(),d=function(){function d(){this.VERSION="0.9.1",typeof AndroidAPIBridge!="undefined"?this.API=new a(new p,new AndroidCommunication):this.API=new a(new p,new WebSocketCommunication),this.GUI=new n,this.storage=new t,this.animation=new c,this.geolocation=new q,this.user=new u,this.accelerometer=new b,this.gyroscope=new o,this.compass=new h,this.device=new i,this.camera=new f,this.media=new r,this.events=new k,this.file=new m,this.extensions=new l}return d.prototype.Deferred=new DeferredEngine,d}(),window.AG=new d,e=function(){function a(){this.goBack=x(this.goBack,this),this.hideBackButton=x(this.hideBackButton,this),this.showBackButton=x(this.showBackButton,this),this.clearHistory=x(this.clearHistory,this),this.getHistory=x(this.getHistory,this),this.setHistory=x(this.setHistory,this),this.addToHistory=x(this.addToHistory,this),this.backstackKey=x(this.backstackKey,this),this.getAncestorNode=x(this.getAncestorNode,this),this.observe_links=x(this.observe_links,this);var a=this;document.addEventListener("DOMContentLoaded",function(){return AG.API.getFeatureID().done(function(b){return a.observe_links(),a.feature_id=b,a.getHistory().done(function(b,c){return c.length?a.showBackButton():a.hideBackButton(),AG.animation.stop()})})},!1)}return a.prototype.feature_id=null,a.prototype.namespace="navigation",a.prototype.configuration={animation:{effectForward:"slideFromRight",effectBack:"slideFromLeft",duration:null,spinner:!0,color:"FFFFFFFF"}},a.prototype.observe_links=function(){var a=this;return document.getElementsByTagName("body")[0].addEventListener("click",function(b){var c;c=a.getAncestorNode(b.target,"A");if(c!=null&&c.getAttribute("data-navigation")!=="false")return b.preventDefault(),a.addToHistory(window.location.href.split(" ").join("%20")).done(function(){return AG.animation.start(c.getAttribute("data-transition-effect")!=null?c.getAttribute("data-transition-effect"):a.configuration.animation.effectForward,{duration:c.getAttribute("data-transition-duration")!=null?c.getAttribute("data-transition-duration"):a.configuration.animation.duration,spinner:c.getAttribute("data-transition-spinner")!=null?c.getAttribute("data-transition-spinner"):a.configuration.animation.spinner,color:c.getAttribute("data-transition-color")!=null?c.getAttribute("data-transition-color"):a.configuration.animation.color}),window.location=c.getAttribute("href")})})},a.prototype.getAncestorNode=function(a,b){while(a){if(a.nodeType===1&&a.nodeName===b)return a;a=a.parentNode}return null},a.prototype.backstackKey=function(){return"navigation_history_"+this.feature_id},a.prototype.addToHistory=function(a){var b,c,d=this;return c=new AG.Deferred,b=this.getHistory(),b.done(function(b,e){return e.push(a),d.setHistory(e),c.resolve(e)}),c},a.prototype.setHistory=function(a){var b,c=this;return b=new AG.Deferred,AG.storage.temporary.set(this.backstackKey(),a).done(function(c){return b.resolve(c,a)}),b},a.prototype.getHistory=function(){var a,b,c=this;return b=new AG.Deferred,a=AG.storage.get(this.backstackKey()),a.done(function(a,c){return b.resolve(a,c)}),a.fail(function(a){return c.clearHistory().done(function(a,c){return b.resolve(a,c)})}),b},a.prototype.clearHistory=function(){return this.setHistory([])},a.prototype.showBackButton=function(){var a=this;return AG.API.backButton().done(function(){return a.goBack()})},a.prototype.hideBackButton=function(){return AG.API.removeBackButton()},a.prototype.goBack=function(){var a=this;return this.hideBackButton(),this.getHistory().done(function(b,c){var d;if(c.length)return d=c.pop(),a.setHistory(c).done(function(){return AG.animation.start(a.configuration.animation.effectBack,{duration:a.configuration.animation.duration,spinner:a.configuration.animation.spinner,color:a.configuration.animation.color}),window.location=d})})},a}(),AG.extensions.add(new e),v=function(){function a(a,b){
return this.url=a,this.opts=b,this.setup_header=x(this.setup_header,this),this.merge_headers=x(this.merge_headers,this),this.merge_options=x(this.merge_options,this),this.default_headers=x(this.default_headers,this),this.default_opts=x(this.default_opts,this),this.done_handler=x(this.done_handler,this),this.merge_options(),this.request=new XMLHttpRequest,this.request.onreadystatechange=this.done_handler,this.request.open(this.opts.type,this.url),this.setup_header(),this.opts.data!=null?this.request.send(JSON.stringify(this.opts.data)):this.request.send(),this.request}return a.prototype.done_handler=function(){var a,b;if(this.request.readyState===4)return this.request.status===200||this.request.status===201||this.request.status===202?(a=this.opts.success)!=null?a.call(this.request,JSON.parse(this.request.response),this.request.status,this.request):void 0:(b=this.opts.failure)!=null?b.call(this.request,this.request.status,this.request):void 0},a.prototype.default_opts=function(){var a;return a={type:"GET",headers:this.default_headers()},a},a.prototype.default_headers=function(){var a;return a={"Content-Type":"application/json",Accepts:"application/json, text/javascript, text/plain, text/html, */*"},a},a.prototype.merge_options=function(){var a,b,c;c=this.default_opts();for(a in c)b=c[a],this.opts[a]==null&&(this.opts[a]=b);return this.merge_headers()},a.prototype.merge_headers=function(){var a,b,c,d;if(this.opts["headers"]==null)return this.opts.headers=this.default_headers();c=this.default_headers(),d=[];for(a in c)b=c[a],this.opts["headers"][a]==null?d.push(this.opts.headers[a]=b):d.push(void 0);return d},a.prototype.setup_header=function(){var a,b,c,d;if(this.opts.headers!=null){c=this.opts.headers,d=[];for(a in c)b=c[a],d.push(this.request.setRequestHeader(a,b));return d}},a}(),w=function(){function a(a,b){this.send=x(this.send,this)}return a.prototype.send=function(a,b){return new v(a,b)},a.prototype.namespace="ajax",a}(),AG.extensions.add(new w),s=function(){function a(){this.get=x(this.get,this)}return a.prototype.namespace="parameters",a.prototype.get=function(a){var b,c;return b=new RegExp("(\\?|&)"+a+"(\\[\\])?=([^&]*)"),c=window.location.search.match(b),c?c[3]:!1},a}(),AG.extensions.add(new s)}.call(this);